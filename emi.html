<!DOCTYPE html>
<html lang="ta">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EMI / Loan | Finance Manager</title>

<style>
body{
  margin:0;
  font-family: Arial, sans-serif;
  background: linear-gradient(135deg,#ff9800,#ffc107);
}
header{
  background:#f57c00;
  color:#fff;
  padding:15px;
  text-align:center;
}
header h2{margin:0;}
header small{font-size:13px;opacity:0.9;}

.container{padding:15px;}
label{display:block;margin-top:10px;font-weight:bold;color:#fff;}
input, select{width:100%; padding:10px; border-radius:8px; border:none; margin-top:5px; font-size:14px;}
button{margin-top:12px;padding:12px;width:100%;border:none;border-radius:10px;cursor:pointer;font-size:16px;color:#fff;}
.add-btn{background:#ef6c00;}
.export-btn{background:#e65100;}
.back-btn{background:#555;margin-top:20px;}
table{width:100%;margin-top:15px;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;}
table th, table td{padding:10px;border-bottom:1px solid #ddd;text-align:left;}
.edit-btn{background:#fbc02d;color:#000;padding:5px;border-radius:5px;}
.del-btn{background:#e53935;color:#fff;padding:5px;border-radius:5px;}
</style>
</head>
<body>

<script>
// ЁЯФР Login check
if(sessionStorage.getItem("loggedIn") !== "yes"){
  window.location.href = "login.html";
}
</script>

<header>
  <h2>ЁЯПж EMI / Loan / роХроЯройрпН</h2>
  <small>Add Loan Master & Monthly EMI</small>
</header>

<div class="container">

  <h3 style="color:#fff;">Loan Master / роХроЯройрпН роорпБродройрпНроорпИ</h3>
  <label>Loan Name / роХроЯройрпН рокрпЖропро░рпН</label>
  <input type="text" id="loanName" placeholder="Bike / Home">

  <label>Bank / ро╡роЩрпНроХро┐</label>
  <input type="text" id="bank" placeholder="SBI / HDFC">

  <label>EMI Amount / родро╡рогрпИ родрпКроХрпИ</label>
  <input type="number" id="emiAmount" placeholder="3200">

  <label>Total Months / роорпКродрпНрод рооро╛родроЩрпНроХро│рпН</label>
  <input type="number" id="totalMonths" placeholder="24">

  <button class="add-btn" onclick="addLoanMaster()">тЮХ Add Loan Master / роЪрпЗро░рпНроХрпНроХ</button>

  <h3 style="color:#fff;margin-top:20px;">Monthly EMI Entry / рооро╛род родро╡рогрпИ</h3>

  <label>Month / рооро╛родроорпН</label>
  <input type="month" id="month">

  <label>Select Loan / роХроЯройрпН родрпЗро░рпНро╡рпБ роЪрпЖропрпНроХ</label>
  <select id="loanSelect"></select>

  <label>EMI Paid Amount / роЪрпЖро▓рпБродрпНродро┐роп родрпКроХрпИ</label>
  <input type="number" id="paidAmount" placeholder="3200">

  <label>Currency / роиро╛рогропроорпН</label>
  <select id="currency">
    <option value="INR">INR тВ╣</option>
    <option value="SGD">SGD $</option>
  </select>

  <button class="add-btn" onclick="addEMI()">тЮХ Add EMI / роЪрпЗро░рпНроХрпНроХ</button>
  <button class="export-btn" onclick="exportCSV()">ЁЯУд Export / роОроХрпНро╕рпНрокрпЛро░рпНроЯрпН</button>
  <button class="back-btn" onclick="back()">тмЕя╕П Back to Dashboard</button>

  <table id="emiTable">
    <thead>
      <tr>
        <th>Month / рооро╛родроорпН</th>
        <th>Loan Name / роХроЯройрпН рокрпЖропро░рпН</th>
        <th>Bank / ро╡роЩрпНроХро┐</th>
        <th>EMI Paid / роЪрпЖро▓рпБродрпНродро┐роп родрпКроХрпИ</th>
        <th>Currency</th>
        <th>Remaining Months / роорпАродроорпБро│рпНро│ рооро╛родроЩрпНроХро│рпН</th>
        <th>Actions / роЪрпЖропро▓рпНроХро│рпН</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

</div>

<script>
let loanMaster = JSON.parse(localStorage.getItem("loanMaster")||"[]");
let emiData = JSON.parse(localStorage.getItem("emiData")||"[]");

function renderLoanSelect(){
  const sel=document.getElementById("loanSelect");
  sel.innerHTML="<option>Select Loan / роХроЯройрпН родрпЗро░рпНро╡рпБ роЪрпЖропрпНроХ</option>";
  loanMaster.forEach((l,i)=>{
    sel.innerHTML+=`<option value="${i}">${l.loanName} - ${l.bank}</option>`;
  });
}

function addLoanMaster(){
  const loanName=document.getElementById("loanName").value.trim();
  const bank=document.getElementById("bank").value.trim();
  const emiAmount=document.getElementById("emiAmount").value;
  const totalMonths=document.getElementById("totalMonths").value;

  if(!loanName || !bank || !emiAmount || !totalMonths){ alert("All fields required / роОро▓рпНро▓ро╛ рокрпБро▓роЩрпНроХро│рпБроорпН роиро┐ро░рокрпНрок ро╡рпЗрогрпНроЯрпБроорпН"); return;}

  loanMaster.push({loanName,bank,emiAmount,totalMonths,remainingMonths:totalMonths});
  localStorage.setItem("loanMaster",JSON.stringify(loanMaster));
  renderLoanSelect();

  document.getElementById("loanName").value="";
  document.getElementById("bank").value="";
  document.getElementById("emiAmount").value="";
  document.getElementById("totalMonths").value="";
}

function addEMI(){
  const month=document.getElementById("month").value;
  const loanIndex=document.getElementById("loanSelect").value;
  const paidAmount=document.getElementById("paidAmount").value;
  const currency=document.getElementById("currency").value;

  if(!month || loanIndex=="Select Loan / роХроЯройрпН родрпЗро░рпНро╡рпБ роЪрпЖропрпНроХ" || !paidAmount){ alert("All fields required / роОро▓рпНро▓ро╛ рокрпБро▓роЩрпНроХро│рпБроорпН роиро┐ро░рокрпНрок ро╡рпЗрогрпНроЯрпБроорпН"); return;}

  const loan=loanMaster[loanIndex];
  if(loan.remainingMonths<=0){ alert("Loan fully paid / роХроЯройрпН роорпБроЯро┐ро╡роЯрпИроирпНродродрпБ"); return;}

  emiData.push({
    month,loanName:loan.loanName,bank:loan.bank,paidAmount,currency,remainingMonths:loan.remainingMonths-1
  });

  loan.remainingMonths-=1;
  localStorage.setItem("loanMaster",JSON.stringify(loanMaster));
  localStorage.setItem("emiData",JSON.stringify(emiData));
  renderTable();
  renderLoanSelect();

  document.getElementById("month").value="";
  document.getElementById("paidAmount").value="";
}

function renderTable(){
  const tbody=document.querySelector("#emiTable tbody");
  tbody.innerHTML="";
  emiData.forEach((item,index)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${item.month}</td>
      <td>${item.loanName}</td>
      <td>${item.bank}</td>
      <td>${item.paidAmount}</td>
      <td>${item.currency}</td>
      <td>${item.remainingMonths}</td>
      <td>
        <button class="edit-btn" onclick="editEMI(${index})">тЬПя╕П</button>
        <button class="del-btn" onclick="deleteEMI(${index})">тЭМ</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function editEMI(i){
  const item=emiData[i];
  document.getElementById("month").value=item.month;
  const loanIdx = loanMaster.findIndex(l=>l.loanName===item.loanName && l.bank===item.bank);
  document.getElementById("loanSelect").value = loanIdx;
  document.getElementById("paidAmount").value = item.paidAmount;
  document.getElementById("currency").value = item.currency;

  deleteEMI(i);
}

function deleteEMI(i){
  if(confirm("Delete this EMI entry? / EMI рокродро┐ро╡рпИ роирпАроХрпНроХрпБро╡ро╛?")){
    const loan = loanMaster.find(l=>l.loanName===emiData[i].loanName && l.bank===emiData[i].bank);
    loan.remainingMonths+=1;
    emiData.splice(i,1);
    localStorage.setItem("loanMaster",JSON.stringify(loanMaster));
    localStorage.setItem("emiData",JSON.stringify(emiData));
    renderTable();
    renderLoanSelect();
  }
}

function exportCSV(){
  if(emiData.length==0){ alert("No data / родро░ро╡рпБ роЗро▓рпНро▓рпИ"); return;}
  let csv="Month,Loan Name,Bank,EMI Paid,Currency,Remaining Months\n";
  emiData.forEach(i=>{
    csv+=`${i.month},${i.loanName},${i.bank},${i.paidAmount},${i.currency},${i.remainingMonths}\n`;
  });
  const blob=new Blob([csv],{type:"text/csv"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;
  a.download="EMI.csv";
  a.click();
}

function back(){ window.location.href="index.html"; }

renderLoanSelect();
renderTable();
</script>

</body>
</html>